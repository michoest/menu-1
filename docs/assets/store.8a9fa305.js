import{a as qe,W as Ve}from"./index.c24c5156.js";import{api as E,session as Ge}from"./axios.f4c7f7be.js";import{notify as S}from"./notify.7d033b23.js";const Je={dark:{type:Boolean,default:null}};function Ye(t,i){return qe(()=>t.dark===null?i.dark.isActive:t.dark)}let ve,oe=0;const T=new Array(256);for(let t=0;t<256;t++)T[t]=(t+256).toString(16).substring(1);const ze=(()=>{const t=typeof crypto!="undefined"?crypto:typeof window!="undefined"?window.crypto||window.msCrypto:void 0;if(t!==void 0){if(t.randomBytes!==void 0)return t.randomBytes;if(t.getRandomValues!==void 0)return i=>{const l=new Uint8Array(i);return t.getRandomValues(l),l}}return i=>{const l=[];for(let y=i;y>0;y--)l.push(Math.floor(Math.random()*256));return l}})(),Ie=4096;function et(){(ve===void 0||oe+16>Ie)&&(oe=0,ve=ze(Ie));const t=Array.prototype.slice.call(ve,oe,oe+=16);return t[6]=t[6]&15|64,t[8]=t[8]&63|128,T[t[0]]+T[t[1]]+T[t[2]]+T[t[3]]+"-"+T[t[4]]+T[t[5]]+"-"+T[t[6]]+T[t[7]]+"-"+T[t[8]]+T[t[9]]+"-"+T[t[10]]+T[t[11]]+T[t[12]]+T[t[13]]+T[t[14]]+T[t[15]]}var We=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},ye={exports:{}};/** @license
 * eventsource.js
 * Available under MIT License (MIT)
 * https://github.com/Yaffle/EventSource/
 */(function(t,i){(function(l){var y=l.setTimeout,F=l.clearTimeout,g=l.XMLHttpRequest,X=l.XDomainRequest,ee=l.ActiveXObject,P=l.EventSource,j=l.document,Oe=l.Promise,te=l.fetch,ge=l.Response,re=l.TextDecoder,me=l.TextEncoder,ie=l.AbortController;if(typeof window!="undefined"&&typeof j!="undefined"&&!("readyState"in j)&&j.body==null&&(j.readyState="loading",window.addEventListener("load",function(e){j.readyState="complete"},!1)),g==null&&ee!=null&&(g=function(){return new ee("Microsoft.XMLHTTP")}),Object.create==null&&(Object.create=function(e){function n(){}return n.prototype=e,new n}),Date.now||(Date.now=function(){return new Date().getTime()}),ie==null){var Le=te;te=function(e,n){var a=n.signal;return Le(e,{headers:n.headers,credentials:n.credentials,cache:n.cache}).then(function(r){var s=r.body.getReader();return a._reader=s,a._aborted&&a._reader.cancel(),{status:r.status,statusText:r.statusText,headers:r.headers,body:{getReader:function(){return s}}}})},ie=function(){this.signal={_reader:null,_aborted:!1},this.abort=function(){this.signal._reader!=null&&this.signal._reader.cancel(),this.signal._aborted=!0}}}function we(){this.bitsNeeded=0,this.codePoint=0}we.prototype.decode=function(e){function n(c,h,d){if(d===1)return c>=128>>h&&c<<h<=2047;if(d===2)return c>=2048>>h&&c<<h<=55295||c>=57344>>h&&c<<h<=65535;if(d===3)return c>=65536>>h&&c<<h<=1114111;throw new Error}function a(c,h){if(c===6*1)return h>>6>15?3:h>31?2:1;if(c===6*2)return h>15?3:2;if(c===6*3)return 3;throw new Error}for(var r=65533,s="",o=this.bitsNeeded,f=this.codePoint,p=0;p<e.length;p+=1){var u=e[p];o!==0&&(u<128||u>191||!n(f<<6|u&63,o-6,a(o,f)))&&(o=0,f=r,s+=String.fromCharCode(f)),o===0?(u>=0&&u<=127?(o=0,f=u):u>=192&&u<=223?(o=6*1,f=u&31):u>=224&&u<=239?(o=6*2,f=u&15):u>=240&&u<=247?(o=6*3,f=u&7):(o=0,f=r),o!==0&&!n(f,o,a(o,f))&&(o=0,f=r)):(o-=6,f=f<<6|u&63),o===0&&(f<=65535?s+=String.fromCharCode(f):(s+=String.fromCharCode(55296+(f-65535-1>>10)),s+=String.fromCharCode(56320+(f-65535-1&1023))))}return this.bitsNeeded=o,this.codePoint=f,s};var Ne=function(){try{return new re().decode(new me().encode("test"),{stream:!0})==="test"}catch(e){console.debug("TextDecoder does not support streaming option. Using polyfill instead: "+e)}return!1};(re==null||me==null||!Ne())&&(re=we);var I=function(){};function k(e){this.withCredentials=!1,this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=I,this.onload=I,this.onerror=I,this.onreadystatechange=I,this._contentType="",this._xhr=e,this._sendTimeout=0,this._abort=I}k.prototype.open=function(e,n){this._abort(!0);var a=this,r=this._xhr,s=1,o=0;this._abort=function(d){a._sendTimeout!==0&&(F(a._sendTimeout),a._sendTimeout=0),(s===1||s===2||s===3)&&(s=4,r.onload=I,r.onerror=I,r.onabort=I,r.onprogress=I,r.onreadystatechange=I,r.abort(),o!==0&&(F(o),o=0),d||(a.readyState=4,a.onabort(null),a.onreadystatechange())),s=0};var f=function(){if(s===1){var d=0,v="",N=void 0;if("contentType"in r)d=200,v="OK",N=r.contentType;else try{d=r.status,v=r.statusText,N=r.getResponseHeader("Content-Type")}catch{d=0,v="",N=void 0}d!==0&&(s=2,a.readyState=2,a.status=d,a.statusText=v,a._contentType=N,a.onreadystatechange())}},p=function(){if(f(),s===2||s===3){s=3;var d="";try{d=r.responseText}catch{}a.readyState=3,a.responseText=d,a.onprogress()}},u=function(d,v){if((v==null||v.preventDefault==null)&&(v={preventDefault:I}),p(),s===1||s===2||s===3){if(s=4,o!==0&&(F(o),o=0),a.readyState=4,d==="load")a.onload(v);else if(d==="error")a.onerror(v);else if(d==="abort")a.onabort(v);else throw new TypeError;a.onreadystatechange()}},c=function(d){r!=null&&(r.readyState===4?(!("onload"in r)||!("onerror"in r)||!("onabort"in r))&&u(r.responseText===""?"error":"load",d):r.readyState===3?"onprogress"in r||p():r.readyState===2&&f())},h=function(){o=y(function(){h()},500),r.readyState===3&&p()};"onload"in r&&(r.onload=function(d){u("load",d)}),"onerror"in r&&(r.onerror=function(d){u("error",d)}),"onabort"in r&&(r.onabort=function(d){u("abort",d)}),"onprogress"in r&&(r.onprogress=p),"onreadystatechange"in r&&(r.onreadystatechange=function(d){c(d)}),("contentType"in r||!("ontimeout"in g.prototype))&&(n+=(n.indexOf("?")===-1?"?":"&")+"padding=true"),r.open(e,n,!0),"readyState"in r&&(o=y(function(){h()},0))},k.prototype.abort=function(){this._abort(!1)},k.prototype.getResponseHeader=function(e){return this._contentType},k.prototype.setRequestHeader=function(e,n){var a=this._xhr;"setRequestHeader"in a&&a.setRequestHeader(e,n)},k.prototype.getAllResponseHeaders=function(){return this._xhr.getAllResponseHeaders!=null&&this._xhr.getAllResponseHeaders()||""},k.prototype.send=function(){if((!("ontimeout"in g.prototype)||!("sendAsBinary"in g.prototype)&&!("mozAnon"in g.prototype))&&j!=null&&j.readyState!=null&&j.readyState!=="complete"){var e=this;e._sendTimeout=y(function(){e._sendTimeout=0,e.send()},4);return}var n=this._xhr;"withCredentials"in n&&(n.withCredentials=this.withCredentials);try{n.send(void 0)}catch(a){throw a}};function Ee(e){return e.replace(/[A-Z]/g,function(n){return String.fromCharCode(n.charCodeAt(0)+32)})}function be(e){for(var n=Object.create(null),a=e.split(`\r
`),r=0;r<a.length;r+=1){var s=a[r],o=s.split(": "),f=o.shift(),p=o.join(": ");n[Ee(f)]=p}this._map=n}be.prototype.get=function(e){return this._map[Ee(e)]},g!=null&&g.HEADERS_RECEIVED==null&&(g.HEADERS_RECEIVED=2);function Se(){}Se.prototype.open=function(e,n,a,r,s,o,f){e.open("GET",s);var p=0;e.onprogress=function(){var c=e.responseText,h=c.slice(p);p+=h.length,a(h)},e.onerror=function(c){c.preventDefault(),r(new Error("NetworkError"))},e.onload=function(){r(null)},e.onabort=function(){r(null)},e.onreadystatechange=function(){if(e.readyState===g.HEADERS_RECEIVED){var c=e.status,h=e.statusText,d=e.getResponseHeader("Content-Type"),v=e.getAllResponseHeaders();n(c,h,d,new be(v))}},e.withCredentials=o;for(var u in f)Object.prototype.hasOwnProperty.call(f,u)&&e.setRequestHeader(u,f[u]);return e.send(),e};function Te(e){this._headers=e}Te.prototype.get=function(e){return this._headers.get(e)};function Ce(){}Ce.prototype.open=function(e,n,a,r,s,o,f){var p=null,u=new ie,c=u.signal,h=new re;return te(s,{headers:f,credentials:o?"include":"same-origin",signal:c,cache:"no-store"}).then(function(d){return p=d.body.getReader(),n(d.status,d.statusText,d.headers.get("Content-Type"),new Te(d.headers)),new Oe(function(v,N){var J=function(){p.read().then(function(_){if(_.done)v(void 0);else{var C=h.decode(_.value,{stream:!0});a(C),J()}}).catch(function(_){N(_)})};J()})}).catch(function(d){if(d.name!=="AbortError")return d}).then(function(d){r(d)}),{abort:function(){p!=null&&p.cancel(),u.abort()}}};function Z(){this._listeners=Object.create(null)}function Re(e){y(function(){throw e},0)}Z.prototype.dispatchEvent=function(e){e.target=this;var n=this._listeners[e.type];if(n!=null)for(var a=n.length,r=0;r<a;r+=1){var s=n[r];try{typeof s.handleEvent=="function"?s.handleEvent(e):s.call(this,e)}catch(o){Re(o)}}},Z.prototype.addEventListener=function(e,n){e=String(e);var a=this._listeners,r=a[e];r==null&&(r=[],a[e]=r);for(var s=!1,o=0;o<r.length;o+=1)r[o]===n&&(s=!0);s||r.push(n)},Z.prototype.removeEventListener=function(e,n){e=String(e);var a=this._listeners,r=a[e];if(r!=null){for(var s=[],o=0;o<r.length;o+=1)r[o]!==n&&s.push(r[o]);s.length===0?delete a[e]:a[e]=s}};function V(e){this.type=e,this.target=void 0}function Ae(e,n){V.call(this,e),this.data=n.data,this.lastEventId=n.lastEventId}Ae.prototype=Object.create(V.prototype);function se(e,n){V.call(this,e),this.status=n.status,this.statusText=n.statusText,this.headers=n.headers}se.prototype=Object.create(V.prototype);function _e(e,n){V.call(this,e),this.error=n.error}_e.prototype=Object.create(V.prototype);var de=-1,B=0,G=1,K=2,fe=-1,U=0,ue=1,xe=2,$e=3,He=/^text\/event\-stream(;.*)?$/i,Me=1e3,Pe=18e6,ce=function(e,n){var a=e==null?n:parseInt(e,10);return a!==a&&(a=n),le(a)},le=function(e){return Math.min(Math.max(e,Me),Pe)},z=function(e,n,a){try{typeof n=="function"&&n.call(e,a)}catch(r){Re(r)}};function O(e,n){Z.call(this),n=n||{},this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,this.url=void 0,this.readyState=void 0,this.withCredentials=void 0,this.headers=void 0,this._close=void 0,Ue(this,e,n)}function je(){return g!=null&&"withCredentials"in g.prototype||X==null?new g:new X}var Be=te!=null&&ge!=null&&"body"in ge.prototype;function Ue(e,n,a){n=String(n);var r=Boolean(a.withCredentials),s=a.lastEventIdQueryParameterName||"lastEventId",o=le(1e3),f=ce(a.heartbeatTimeout,45e3),p="",u=o,c=!1,h=0,d=a.headers||{},v=a.Transport,N=Be&&v==null?void 0:new k(v!=null?new v:je()),J=v!=null&&typeof v!="string"?new v:N==null?new Ce:new Se,_=void 0,C=0,L=de,W="",ne="",$="",ae="",R=U,he=0,q=0,Xe=function(w,m,x,D){if(L===B)if(w===200&&x!=null&&He.test(x)){L=G,c=Date.now(),u=o,e.readyState=G;var A=new se("open",{status:w,statusText:m,headers:D});e.dispatchEvent(A),z(e,e.onopen,A)}else{var b="";w!==200?(m&&(m=m.replace(/\s+/g," ")),b="EventSource's response has a status "+w+" "+m+" that is not 200. Aborting the connection."):b="EventSource's response has a Content-Type specifying an unsupported type: "+(x==null?"-":x.replace(/\s+/g," "))+". Aborting the connection.",pe();var A=new se("error",{status:w,statusText:m,headers:D});e.dispatchEvent(A),z(e,e.onerror,A),console.error(b)}},ke=function(w){if(L===G){for(var m=-1,x=0;x<w.length;x+=1){var D=w.charCodeAt(x);(D===`
`.charCodeAt(0)||D==="\r".charCodeAt(0))&&(m=x)}var A=(m!==-1?ae:"")+w.slice(0,m+1);ae=(m===-1?ae:"")+w.slice(m+1),w!==""&&(c=Date.now(),h+=w.length);for(var b=0;b<A.length;b+=1){var D=A.charCodeAt(b);if(R===fe&&D===`
`.charCodeAt(0))R=U;else if(R===fe&&(R=U),D==="\r".charCodeAt(0)||D===`
`.charCodeAt(0)){if(R!==U){R===ue&&(q=b+1);var H=A.slice(he,q-1),M=A.slice(q+(q<b&&A.charCodeAt(q)===" ".charCodeAt(0)?1:0),b);H==="data"?(W+=`
`,W+=M):H==="id"?ne=M:H==="event"?$=M:H==="retry"?(o=ce(M,o),u=o):H==="heartbeatTimeout"&&(f=ce(M,f),C!==0&&(F(C),C=y(function(){Y()},f)))}if(R===U){if(W!==""){p=ne,$===""&&($="message");var Q=new Ae($,{data:W.slice(1),lastEventId:ne});if(e.dispatchEvent(Q),$==="open"?z(e,e.onopen,Q):$==="message"?z(e,e.onmessage,Q):$==="error"&&z(e,e.onerror,Q),L===K)return}W="",$=""}R=D==="\r".charCodeAt(0)?fe:U}else R===U&&(he=b,R=ue),R===ue?D===":".charCodeAt(0)&&(q=b+1,R=xe):R===xe&&(R=$e)}}},Fe=function(w){if(L===G||L===B){L=de,C!==0&&(F(C),C=0),C=y(function(){Y()},u),u=le(Math.min(o*16,u*2)),e.readyState=B;var m=new _e("error",{error:w});e.dispatchEvent(m),z(e,e.onerror,m),w!=null&&console.error(w)}},pe=function(){L=K,_!=null&&(_.abort(),_=void 0),C!==0&&(F(C),C=0),e.readyState=K},Y=function(){if(C=0,L!==de){if(!c&&_!=null)Fe(new Error("No activity within "+f+" milliseconds. "+(L===B?"No response received.":h+" chars received.")+" Reconnecting.")),_!=null&&(_.abort(),_=void 0);else{var w=Math.max((c||Date.now())+f-Date.now(),1);c=!1,C=y(function(){Y()},w)}return}c=!1,h=0,C=y(function(){Y()},f),L=B,W="",$="",ne=p,ae="",he=0,q=0,R=U;var m=n;if(n.slice(0,5)!=="data:"&&n.slice(0,5)!=="blob:"&&p!==""){var x=n.indexOf("?");m=x===-1?n:n.slice(0,x+1)+n.slice(x+1).replace(/(?:^|&)([^=&]*)(?:=[^&]*)?/g,function(M,Q){return Q===s?"":M}),m+=(n.indexOf("?")===-1?"?":"&")+s+"="+encodeURIComponent(p)}var D=e.withCredentials,A={};A.Accept="text/event-stream";var b=e.headers;if(b!=null)for(var H in b)Object.prototype.hasOwnProperty.call(b,H)&&(A[H]=b[H]);try{_=J.open(N,Xe,ke,Fe,m,D,A)}catch(M){throw pe(),M}};e.url=n,e.readyState=B,e.withCredentials=r,e.headers=d,e._close=pe,Y()}O.prototype=Object.create(Z.prototype),O.prototype.CONNECTING=B,O.prototype.OPEN=G,O.prototype.CLOSED=K,O.prototype.close=function(){this._close()},O.CONNECTING=B,O.OPEN=G,O.CLOSED=K,O.prototype.withCredentials=void 0;var De=P;g!=null&&(P==null||!("withCredentials"in P.prototype))&&(De=O),function(e){{var n=e(i);n!==void 0&&(t.exports=n)}}(function(e){e.EventSourcePolyfill=O,e.NativeEventSource=P,e.EventSource=De})})(typeof globalThis=="undefined"?typeof window!="undefined"?window:typeof self!="undefined"?self:We:globalThis)})(ye,ye.exports);const tt=Ve("store",{state:()=>({global:{status:"loading",sse:null},persistent:{api:"http://localhost:3001",token:null},user:null,data:{},list:{items:[],showCompletedItems:!1},menu:{dishes:[],ingredients:[]}}),getters:{},actions:{async fetch(){var t,i,l;try{if(this.persistent.token){this.global.status="loading";const y=await E.get("/data");({data:this.data,user:this.user}=y.data)}this.global.sse||this.connectToSSE(),this.global.status="ok"}catch(y){const F=(l=(i=(t=y.response)==null?void 0:t.data)==null?void 0:i.notification)==null?void 0:l.message;if(F)switch(F){case"jwt malformed":case"Not authenticated!":case"jwt expired":S("Redirecting to login..."),this.logout(),this.router.push("/login"),this.global.status="ok";break}else console.error(y),this.global.status="error",S(`Error: ${y}`,{type:"negative"})}},async login({email:t,password:i}){var l,y,F;try{const g=await E.post("/auth/login",{email:t,password:i}),{user:X,data:ee,token:P}=g.data;P&&(this.user=X,this.data=ee,this.persistent.token=P,E.defaults.headers.common.Authorization=`Bearer ${P}`,S(`Logged in as ${X.name.first} ${X.name.last}!`),this.connectToSSE(),this.router.push({path:"/list"}))}catch(g){((F=(y=(l=g.response)==null?void 0:l.data)==null?void 0:y.notification)==null?void 0:F.message)||(console.error(g),S(`Error: ${g}`,{type:"negative"}))}},async logout(){this.global.status="loading",this.user=null,this.persistent.token=null,this.closeSSE(),E.defaults.headers.common.Authorization=null,S("Logged out!"),this.router.push("/login")},async fetchList(){try{const t=await E.get("/list");this.list=t.data}catch(t){S(`Error: ${t}`,{type:"negative"})}},async fetchMenu(){try{const t=await E.get("/menu");this.menu=t.data}catch(t){S(`Error: ${t}`,{type:"negative"})}},async addItem(t){try{const i=await E.post("/list/item/",t);return this.list=i.data.list,i.data.id}catch(i){return S(`Error: ${i}`,{type:"negative"}),null}},async saveItem(t){try{const i=await E.put(`/list/item/${t.id}`,t);this.list=i.data}catch(i){S(`Error: ${i}`,{type:"negative"})}},async completeItem(t){try{const i=await E.post(`/list/item/${t}/complete`);return this.list=i.data,!0}catch(i){S(`Error: ${i}`,{type:"negative"})}},async openItem(t){try{const i=await E.post(`/list/item/${t}/open`);return this.list=i.data,!0}catch(i){S(`Error: ${i}`,{type:"negative"})}},async addToList(t){try{const i=await E.post("/menu/",{ingredients:t});return{list:this.list,menu:this.menu}=i.data,!0}catch(i){S(`Error: ${i}`,{type:"negative"})}},async clearList(){try{const t=await E.post("/list/clear");return this.list=t.data,!0}catch(t){S(`Error: ${t}`,{type:"negative"})}},async deleteCompletedItems(){try{const t=await E.delete("/list/delete-completed-items");return this.list=t.data,!0}catch(t){S(`Error: ${t}`,{type:"negative"})}},async showCompletedItems(t){try{const i=await E.post(`/list/show-completed-items/${t}`);this.list.showCompletedItems=t}catch(i){S(`Error: ${i}`,{type:"negative"})}},async editDish(t){try{const i=await E.put(`/menu/dish/${t.id}`,t),l=this.menu.dishes.find(y=>t.id==t.id);return this.menu.dishes.splice(l,1,i.data),!0}catch(i){S(`Error: ${i}`,{type:"negative"})}},async saveVendors(t){try{const i=await E.put("/menu/vendors",t);return this.menu.ingredients=i.data,!0}catch(i){S(`Error: ${i}`,{type:"negative"})}},async checkAPI(t){try{return await E.get(`${t}/ping`,{baseURL:""}),!0}catch{return!1}},setAPI(t){this.persistent.api=t,E.defaults.baseURL=t},async connectToSSE(){if(!this.global.sse){const t=new ye.exports.EventSourcePolyfill("http://localhost:3001/events",{headers:{session:Ge}});t.addEventListener("message",i=>{}),t.addEventListener("error",i=>{t.close(),this.global.sse=null}),this.global.sse=t}},async closeSSE(){this.global.sse&&(this.global.sse.close(),this.global.sse=null)}},persist:{storage:sessionStorage,paths:["persistent"],afterRestore:t=>{const i=t.app.config.globalProperties.$api;i.defaults.baseURL=t.store.persistent.api,t.store.persistent.token!=null&&(i.defaults.headers.common.Authorization=`Bearer ${t.store.persistent.token}`),t.store.data={},t.store.global.status="loading"}}});export{tt as a,Je as b,Ye as c,We as d,et as u};
