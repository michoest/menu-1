import{Q as w,a as j}from"./QCard.d0cd7da1.js";import{e as A,Q}from"./QInput.4145ff79.js";import{i as I,aJ as k,c as L,r as F,p as R,C as D,D as K,j as B,h as O,d as J,g as N,X as U,s as P,A as $,ar as M,I as T,J as X,K as c,L as u,a7 as E,_ as q}from"./index.c24c5156.js";import{Q as z}from"./QPage.9887f8a4.js";import{a as G}from"./store.8a9fa305.js";import"./axios.f4c7f7be.js";import"./notify.7d033b23.js";function H(){return I(k)}var W=L({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(i,{slots:f,emit:s}){const p=N(),d=F(null);let o=0;const a=[];function g(e){const l=typeof e=="boolean"?e:i.noErrorFocus!==!0,v=++o,h=(t,n)=>{s(`validation${t===!0?"Success":"Error"}`,n)},S=t=>{const n=t.validate();return typeof n.then=="function"?n.then(r=>({valid:r,comp:t}),r=>({valid:!1,comp:t,err:r})):Promise.resolve({valid:n,comp:t})};return(i.greedy===!0?Promise.all(a.map(S)).then(t=>t.filter(n=>n.valid!==!0)):a.reduce((t,n)=>t.then(()=>S(n).then(r=>{if(r.valid===!1)return Promise.reject(r)})),Promise.resolve()).catch(t=>[t])).then(t=>{if(t===void 0||t.length===0)return v===o&&h(!0),!0;if(v===o){const{comp:n,err:r}=t[0];if(r!==void 0&&console.error(r),h(!1,n),l===!0){const C=t.find(({comp:V})=>typeof V.focus=="function"&&U(V.$)===!1);C!==void 0&&C.comp.focus()}}return!1})}function b(){o++,a.forEach(e=>{typeof e.resetValidation=="function"&&e.resetValidation()})}function y(e){e!==void 0&&P(e);const l=o+1;g().then(v=>{l===o&&v===!0&&(i.onSubmit!==void 0?s("submit",e):e!==void 0&&e.target!==void 0&&typeof e.target.submit=="function"&&e.target.submit())})}function x(e){e!==void 0&&P(e),s("reset"),$(()=>{b(),i.autofocus===!0&&i.noResetFocus!==!0&&m()})}function m(){A(()=>{if(d.value===null)return;const e=d.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||d.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||d.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(d.value.querySelectorAll("[tabindex]"),l=>l.tabIndex!==-1);e!=null&&e.focus({preventScroll:!0})})}R(M,{bindComponent(e){a.push(e)},unbindComponent(e){const l=a.indexOf(e);l!==-1&&a.splice(l,1)}});let _=!1;return D(()=>{_=!0}),K(()=>{_===!0&&i.autofocus===!0&&m()}),B(()=>{i.autofocus===!0&&m()}),Object.assign(p.proxy,{validate:g,resetValidation:b,submit:y,reset:x,focus:m,getValidationComponents:()=>a}),()=>O("form",{class:"q-form",ref:d,onSubmit:y,onReset:x},J(f.default))}});const Y=E("div",{class:"text-h6 text-center"},"Login",-1),Z={class:"row justify-center q-mt-md"},le=Object.assign({name:"LoginPage"},{__name:"login.page",setup(i){const f=G();H(),B(async()=>{f.global.status="ok"});const s=F({email:"",password:""}),p=async()=>{await f.login(s.value)};return(d,o)=>(T(),X(z,{class:"flex flex-center"},{default:c(()=>[u(j,{style:{width:"350px","max-width":"90vw"}},{default:c(()=>[u(w,null,{default:c(()=>[Y]),_:1}),u(w,null,{default:c(()=>[u(W,{onSubmit:p,class:"q-gutter-md"},{default:c(()=>[u(Q,{filled:"",modelValue:s.value.email,"onUpdate:modelValue":o[0]||(o[0]=a=>s.value.email=a),label:"E-mail"},null,8,["modelValue"]),u(Q,{filled:"",modelValue:s.value.password,"onUpdate:modelValue":o[1]||(o[1]=a=>s.value.password=a),label:"Password",type:"password"},null,8,["modelValue"]),E("div",Z,[u(q,{label:"Login",type:"submit",color:"primary"}),u(q,{to:"/signup",label:"Sign up",flat:"",class:"q-ml-md",disable:""})])]),_:1})]),_:1})]),_:1})]),_:1}))}});export{le as default};
